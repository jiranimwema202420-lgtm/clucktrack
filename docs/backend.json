{
  "entities": {
    "Poultry": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Poultry",
      "type": "object",
      "description": "Represents a single poultry bird.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Poultry entity."
        },
        "batchId": {
          "type": "string",
          "description": "Reference to Batch. (Relationship: Batch 1:N Poultry)"
        },
        "species": {
          "type": "string",
          "description": "The species of poultry (e.g., chicken, turkey, duck)."
        },
        "breed": {
          "type": "string",
          "description": "The breed of poultry (e.g., broiler, layer)."
        },
        "hatchDate": {
          "type": "string",
          "description": "The date the poultry hatched.",
          "format": "date-time"
        },
        "weight": {
          "type": "number",
          "description": "The current weight of the poultry in kilograms."
        },
        "healthStatus": {
          "type": "string",
          "description": "The current health status of the poultry (e.g., healthy, sick)."
        }
      },
      "required": [
        "id",
        "batchId",
        "species",
        "breed",
        "hatchDate",
        "weight",
        "healthStatus"
      ]
    },
    "Batch": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Batch",
      "type": "object",
      "description": "Represents a batch of poultry.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Batch entity."
        },
        "name": {
          "type": "string",
          "description": "The name of the batch."
        },
        "startDate": {
          "type": "string",
          "description": "The date the batch was started.",
          "format": "date-time"
        },
        "expectedEndDate": {
          "type": "string",
          "description": "The expected end date of the batch.",
          "format": "date-time"
        },
        "initialQuantity": {
          "type": "number",
          "description": "The initial quantity of poultry in the batch."
        }
      },
      "required": [
        "id",
        "name",
        "startDate",
        "expectedEndDate",
        "initialQuantity"
      ]
    },
    "SensorData": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "SensorData",
      "type": "object",
      "description": "Represents sensor data collected from farm equipment.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the SensorData entity."
        },
        "timestamp": {
          "type": "string",
          "description": "The timestamp of the sensor data.",
          "format": "date-time"
        },
        "temperature": {
          "type": "number",
          "description": "The temperature reading in Celsius."
        },
        "humidity": {
          "type": "number",
          "description": "The humidity reading in percentage."
        },
        "feedLevel": {
          "type": "number",
          "description": "The feed level reading in kilograms."
        },
        "waterLevel": {
          "type": "number",
          "description": "The water level reading in liters."
        }
      },
      "required": [
        "id",
        "timestamp",
        "temperature",
        "humidity",
        "feedLevel",
        "waterLevel"
      ]
    },
    "Feed": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Feed",
      "type": "object",
      "description": "Represents a type of feed.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Feed entity."
        },
        "name": {
          "type": "string",
          "description": "The name of the feed."
        },
        "nutrientComposition": {
          "type": "string",
          "description": "The nutrient composition of the feed."
        },
        "costPerUnit": {
          "type": "number",
          "description": "The cost per unit of the feed."
        }
      },
      "required": [
        "id",
        "name",
        "nutrientComposition",
        "costPerUnit"
      ]
    },
    "FeedConsumption": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "FeedConsumption",
      "type": "object",
      "description": "Represents the consumption of feed by a batch.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the FeedConsumption entity."
        },
        "batchId": {
          "type": "string",
          "description": "Reference to Batch. (Relationship: Batch 1:N FeedConsumption)"
        },
        "feedId": {
          "type": "string",
          "description": "Reference to Feed. (Relationship: Feed 1:N FeedConsumption)"
        },
        "date": {
          "type": "string",
          "description": "The date of the feed consumption.",
          "format": "date-time"
        },
        "quantity": {
          "type": "number",
          "description": "The quantity of feed consumed."
        }
      },
      "required": [
        "id",
        "batchId",
        "feedId",
        "date",
        "quantity"
      ]
    },
    "Alert": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Alert",
      "type": "object",
      "description": "Represents an alert generated by the system.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Alert entity."
        },
        "timestamp": {
          "type": "string",
          "description": "The timestamp of the alert.",
          "format": "date-time"
        },
        "type": {
          "type": "string",
          "description": "The type of alert (e.g., health, environment)."
        },
        "message": {
          "type": "string",
          "description": "The message of the alert."
        },
        "batchId": {
          "type": "string",
          "description": "Reference to Batch. (Relationship: Batch 1:N Alert)"
        },
        "poultryId": {
          "type": "string",
          "description": "Reference to Poultry. (Relationship: Poultry 1:N Alert)"
        }
      },
      "required": [
        "id",
        "timestamp",
        "type",
        "message"
      ]
    },
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the system.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the User entity."
        },
        "name": {
          "type": "string",
          "description": "The name of the user."
        },
        "email": {
          "type": "string",
          "description": "The email address of the user.",
          "format": "email"
        },
        "role": {
          "type": "string",
          "description": "The role of the user (e.g., admin, worker, vet)."
        }
      },
      "required": [
        "id",
        "name",
        "email",
        "role"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profile data. Only the user can read/write their own document.",
          "params": [
            {
              "name": "userId",
              "description": "The unique ID of the user."
            }
          ]
        }
      },
      {
        "path": "/roles_admin/{userId}",
        "definition": {
          "entityName": "AdminRole",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Marks a user as an admin. The existence of this document grants admin privileges.",
          "params": [
            {
              "name": "userId",
              "description": "The unique ID of the user."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/batches/{batchId}",
        "definition": {
          "entityName": "Batch",
          "schema": {
            "$ref": "#/backend/entities/Batch"
          },
          "description": "Stores batch data for a user. Only the user can read/write their own batches.",
          "params": [
            {
              "name": "userId",
              "description": "The unique ID of the user."
            },
            {
              "name": "batchId",
              "description": "The unique ID of the batch."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/batches/{batchId}/poultry/{poultryId}",
        "definition": {
          "entityName": "Poultry",
          "schema": {
            "$ref": "#/backend/entities/Poultry"
          },
          "description": "Stores poultry data for a specific batch owned by a user. Includes denormalized 'batchId' for authorization independence.",
          "params": [
            {
              "name": "userId",
              "description": "The unique ID of the user."
            },
            {
              "name": "batchId",
              "description": "The unique ID of the batch."
            },
            {
              "name": "poultryId",
              "description": "The unique ID of the poultry."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/sensorData/{sensorDataId}",
        "definition": {
          "entityName": "SensorData",
          "schema": {
            "$ref": "#/backend/entities/SensorData"
          },
          "description": "Stores sensor data for a user. Only the user can read/write their own sensor data.",
          "params": [
            {
              "name": "userId",
              "description": "The unique ID of the user."
            },
            {
              "name": "sensorDataId",
              "description": "The unique ID of the sensor data."
            }
          ]
        }
      },
      {
        "path": "/feeds/{feedId}",
        "definition": {
          "entityName": "Feed",
          "schema": {
            "$ref": "#/backend/entities/Feed"
          },
          "description": "Stores feed data. Accessible to users with appropriate roles (e.g., admin).",
          "params": [
            {
              "name": "feedId",
              "description": "The unique ID of the feed."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/batches/{batchId}/feedConsumption/{feedConsumptionId}",
        "definition": {
          "entityName": "FeedConsumption",
          "schema": {
            "$ref": "#/backend/entities/FeedConsumption"
          },
          "description": "Stores feed consumption data for a specific batch owned by a user. Includes denormalized 'batchId' and 'feedId' for authorization independence.",
          "params": [
            {
              "name": "userId",
              "description": "The unique ID of the user."
            },
            {
              "name": "batchId",
              "description": "The unique ID of the batch."
            },
            {
              "name": "feedConsumptionId",
              "description": "The unique ID of the feed consumption record."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/batches/{batchId}/alerts/{alertId}",
        "definition": {
          "entityName": "Alert",
          "schema": {
            "$ref": "#/backend/entities/Alert"
          },
          "description": "Stores alert data for a specific batch owned by a user.",
          "params": [
            {
              "name": "userId",
              "description": "The unique ID of the user."
            },
            {
              "name": "batchId",
              "description": "The unique ID of the batch."
            },
            {
              "name": "alertId",
              "description": "The unique ID of the alert."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to ensure Authorization Independence, support QAPs (queries are not filters), and provide clarity for security rules. Authorization independence is achieved by denormalizing relevant authorization data (ownership, membership) into subcollections, eliminating the need for `get()` calls in security rules. Structural Segregation is used to enforce homogeneous security postures within collections.  Access Modeling follows consistent patterns for user-owned data and collaborative data.\n\n*   User Data: User profiles are stored in `/users/{userId}`.  Roles can be managed via a dedicated collection `/roles/{userId}` (existence-based). This facilitates global role-based access control without custom claims.  Path-based ownership ensures only the user can access their data.\n*   Batch & Poultry Data: Batches are stored under the owning user's document at `/users/{userId}/batches/{batchId}`.  Poultry associated with a batch are stored as subcollections `/users/{userId}/batches/{batchId}/poultry/{poultryId}`. The `batchId` is denormalized onto each `Poultry` document. Ownership is implicit via the path.\n*   Sensor Data: Stored in `/users/{userId}/sensorData/{sensorDataId}`.\n*   Feed & Feed Consumption:  Feeds are stored in a top-level `/feeds/{feedId}` collection. FeedConsumption is stored under the batch at `/users/{userId}/batches/{batchId}/feedConsumption/{feedConsumptionId}`.  The `feedId` and `batchId` are denormalized onto each `FeedConsumption` document.\n*   Alerts: Alerts are stored within the batch at `/users/{userId}/batches/{batchId}/alerts/{alertId}` and include the `poultryId`.\n\nThis design supports QAPs because list operations can be secured based on path-based ownership and the existence of role documents."
  }
}